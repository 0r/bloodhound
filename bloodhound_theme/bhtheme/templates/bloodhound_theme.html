<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/"
      py:strip="">
  <py:match path="head" once="true"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"/>
    <title py:with="title = list(select('title/text()'))" py:choose="">
      <py:when test="title">${title}</py:when>
      <py:otherwise>${project.name or 'Apache(TM) Bloodhound'}</py:otherwise>
    </title>
    <link rel="stylesheet" href="/main/chrome/theme/bootstrap.css" type="text/css" />
    <py:if test="chrome.links">
      <py:for each="rel, links in chrome.links.items()">
        <link rel="${rel}" py:for="link in links" py:attrs="link"/>
      </py:for>
    </py:if>
    <py:if test="'SEARCH_VIEW' in perm" id="search">
      <link type="application/opensearchdescription+xml" rel="search"
            href="${href.search('opensearch')}" title="Search $project.name"/>
    </py:if>
    <script py:for="script in chrome.scripts"
            type="${script.type}" src="${script.href}"></script>
    <script src="${href.chrome('theme/scripts/jquery-1.7.1.min.js')}"
        type="text/javascript"></script>
    <script src="${href.chrome('theme/scripts/theme.js')}"
        type="text/javascript"></script>
    <script src="${href.chrome('theme/scripts/bootstrap-dropdown.js')}"
        type="text/javascript"></script>
    <!-- script src="${href.chrome('theme/scripts/bootstrap-tooltip.js')}"
        type="text/javascript"></script>
    <script src="${href.chrome('theme/scripts/bootstrap-popover.js')}"
        type="text/javascript"></script -->
    <script src="${href.chrome('theme/scripts/dashboard.js')}"
        type="text/javascript"></script>
    ${Markup('&lt;!--[if lt IE 7]&gt;')}
    <script type="text/javascript" src="${chrome.htdocs_location}js/ie_pre7_hacks.js"></script>
    ${Markup('&lt;![endif]--&gt;')}
    ${select("*[local-name() != 'title']")}

  </head></py:match>

  <py:match path="body" once="true" buffer="false"><body>
    <div class="container">
      <div class="row" style="position:relative;">
        <div class="span4">
          <!-- TODO: Support different logo dimensions -->
          <img src="${chrome.logo.src or href.chrome('theme/images/bh_logo.png')}" 
              alt="Bloodhound Logo" height="47" width="161" />
        </div>
        <py:with vars="meta_items = dict([i.name, i] for i in chrome.nav.metanav)">
          <div class="span8" style="position:absolute; bottom:25%; right:-45%;">
            <span id="nav_login">${meta_items.login.label}</span>
            <span py:if="'logout' in meta_items" id="nav_logout">
              ${meta_items.logout.label}
            </span>
            &nbsp;&nbsp;
            <span py:if="'prefs' in meta_items"><i class="icon-cog"></i>
              ${meta_items.prefs.label}
            </span>
            <span py:if="'help' in meta_items"><i class="icon-question-sign"></i>
              ${meta_items.help.label}
            </span>
          </div>
        </py:with>
      </div>
      <div class="row" style="position:relative;">
        <div class="span4">
          <form id="mainsearch" class="form-inline" action="${href.search()}" method="get">
            <input type="text" class="span3" name="q"
                placeholder="Search anything. Try #EF-492." />
            <input type="submit" value="Search" class="btn btn-warning"/>
          </form>
        </div>
        <div class="span4">
          <py:def function="field_select(field, value)">
            <select id="field-${field.name}" name="field_${field.name}"
                class="input-mini" data-empty="true" data-field="${field.name}">
              <option py:if="field.optional"></option>
              <option py:for="option in field.options"
                      selected="${value == option or None}"
                      py:content="option"></option>
              <optgroup py:for="optgroup in field.optgroups"
                        py:if="optgroup.options"
                        label="${optgroup.label}">
                <option py:for="option in optgroup.options"
                        selected="${value == option or None}"
                        py:content="option"></option>
              </optgroup>
            </select>
          </py:def>
          <py:def function="qct_box()">
            <label for="field-summary">Summary</label>
            <input class="input-medium" type="text" id="field-summary"
                name="field_summary" placeholder="Ticket summary" />
            <label for="field-project">Project</label>
            <input class="input-medium disabled" id="field-project" type="text" 
                placeholder="Target project" disabled="" />
            <div class="form-horizontal">
              <label class="control-label" for="field-version">Version</label>
              <div class="controls">
                <!-- input name="qct_version" class="input-mini" type="text" 
                    placeholder="Version" / -->
                ${field_select(qct.fields.version, None)}
                <p class="help-block">Most recent by default</p>
              </div>
              <label class="control-label" for="field-type">Type</label>
              <div class="controls">
                <!-- input name="qct_type" class="input-mini" type="text" 
                    placeholder="Type" / -->
                ${field_select(qct.fields.type, None)}
                <p class="help-block">Select ticket type</p>
              </div>
              <label class="control-label" for="field-component">Component</label>
              <div class="controls">
                <!-- input name="qct_component" class="input-mini" type="text" 
                    placeholder="Component" / -->
                ${field_select(qct.fields.component, None)}
                <p class="help-block">Select component</p>
              </div>
            </div>
          </py:def>
          <py:choose test="">
            <py:when test="qct">
              <div class="btn-group">
                <a href="${href.newticket()}" class="btn btn-inverse">
                  Create Ticket
                </a>
                <a href="#" class="btn btn-inverse dropdown-toggle"
                    data-toggle="dropdown">
                  <i class="caret"></i>
                </a>
                <div id="qct-box" class="dropdown-menu">
                  <style>
                    #qct-box .help-block { white-space: nowrap; }
                    #qct-box .form-horizontal .controls .help-block { 
                      margin-left: -20px;
                    }
                    #qct-box .form-horizontal .controls { margin-left: 90px; }
                    #qct-box .form-horizontal .control-label { width : 70px; }
                    #qct-box .input-mini { width : 100px; }
                  </style>
                  <div class="popover-title"><h3>Create Ticket</h3></div>
                  <div class="popover-content">
                    <form id="qct-form" name="qct" method="post">
                      <div id="qct-fieldset">
                        ${qct_box()}
                      </div>
                    </form>
                    <div class="btn-toolbar">
                      <div class="btn-group">
                          <button id="qct-create" class="btn btn-primary" 
                              data-target="${href.qct()}">
                            Create
                          </button> 
                        </div>
                        <div class="btn-group">
                          <button id="qct-cancel" class="btn btn-danger">
                            Cancel
                          </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </py:when>
            <py:otherwise>
              &nbsp;
            </py:otherwise>
          </py:choose>
        </div>
        <div class="span4">
          <ul py:if="chrome.nav.mainnav or chrome.nav.metanav"
              class="nav nav-tabs pull-right"
              id="mainnav"
              py:with="mainnav_show = ('wiki', 'tickets', 'browser')">
            <!-- TODO: Parameterize visible mainnav items in trac.ini -->
            <li py:if="chrome.nav.mainnav"
                py:for="idx, item in enumerate(i for i in chrome.nav.mainnav if i.name in mainnav_show)" 
                class="${classes(first_last(idx, chrome.nav.mainnav), active=item.active)}">${item.label}</li>
            <li class="dropdown ${all(not i.active for i in chrome.nav.mainnav if i.name in mainnav_show) and 'active' or None}">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Apps<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li py:if="chrome.nav.mainnav"
                    py:for="idx, item in enumerate(i for i in chrome.nav.mainnav if i.name not in mainnav_show)" 
                    class="${classes(first_last(idx, chrome.nav.mainnav), active=item.active)}">${item.label}</li>
                <py:if test="chrome.nav.metanav">
                  <li class="divider"></li>
                  <li py:for="idx, item in enumerate(chrome.nav.metanav)"
                      class="${classes(first_last(idx, chrome.nav.metanav), active=item.active)}">
                    ${item.label}
                  </li>
                </py:if>
              </ul>
            </li>
          </ul>
        </div>
        <div class="span12">
          <ul class="breadcrumb">
            <li py:choose="">
              <xi:include py:when="value_of('resourcepath_template')" 
                  href="${resourcepath_template}" />
              <py:otherwise>&nbsp;</py:otherwise>
            </li>
            <li class="pull-right">
              <py:for py:if="chrome.ctxtnav"
                  py:with="max_idx = len(chrome.ctxtnav) - 1"
                  each="idx, item in enumerate(chrome.ctxtnav)">
                $item
                <py:if test="idx &lt; max_idx">&nbsp;&nbsp;&nbsp;&nbsp;</py:if>
              </py:for>
            </li>
          </ul>
        </div>
        <div style="text-align: right;" class="span3"></div>
      </div>
      <div id="warning" py:if="chrome.warnings" class="system-message">
        <py:choose test="len(chrome.warnings)">
          <strong>Warning:</strong>
          <py:when test="1">${chrome.warnings[0]}</py:when>
          <py:otherwise><ul><li py:for="warning in chrome.warnings">$warning</li></ul></py:otherwise>
        </py:choose>
      </div>
      <div id="notice" py:if="chrome.notices" class="system-message">
        <py:choose test="len(chrome.notices)">
          <py:when test="1">${chrome.notices[0]}</py:when>
          <py:otherwise><ul><li py:for="notice in chrome.notices">$notice</li></ul></py:otherwise>
        </py:choose>
      </div>
      ${select('*|text()|comment()')}
      <div class="row">
        <br/>
        <div class="span8" style="color:grey;">
          Powered by <a href="http://www.apache.org/">Apache<sup>TM</sup></a> <a href="${href.about()}"><strong>Bloodhound</strong></a>.
          Standing on the shoulders of 
          <a href="http://trac.edgewall.org/"><strong>Trac ${trac.version}</strong></a>.
        </div>
        <div class="span4" style="text-align:right; color:grey;">${chrome.footer}</div>
      </div>
    </div>
    <br/>
</body></py:match></html>
